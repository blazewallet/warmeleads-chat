"use strict";(()=>{var e={};e.id=70,e.ids=[70],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},1764:e=>{e.exports=require("util")},5474:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>l});var r={};a.r(r),a.d(r,{OPTIONS:()=>p,POST:()=>c});var n=a(9303),s=a(8716),o=a(670),i=a(7070),u=a(6029);async function c(e){try{let t;let{amount:a,currency:r="eur",customerInfo:n,orderDetails:s,paymentMethod:o}=await e.json();if(!a||!n?.name||!n?.email)return i.NextResponse.json({error:"Missing required fields"},{status:400});let c=await u.Ag.customers.list({email:n.email,limit:1});t=c.data.length>0?c.data[0]:await u.Ag.customers.create({name:n.name,email:n.email,phone:n.phone,metadata:{company:n.company||"",source:"WarmeLeads Chat"}});let p=await u.Ag.paymentIntents.create({amount:Math.round(a),currency:r,customer:t.id,metadata:{industry:s.industry,leadType:s.leadType,quantity:s.quantity,customerName:n.name,customerCompany:n.company||"",source:"express_checkout"},description:`${s.leadType} ${s.industry} leads - ${s.quantity}`,receipt_email:n.email,automatic_payment_methods:{enabled:!0}});return i.NextResponse.json({clientSecret:p.client_secret,paymentIntentId:p.id})}catch(e){return console.error("Payment intent creation failed:",e),i.NextResponse.json({error:"Failed to create payment intent"},{status:500})}}async function p(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/create-payment-intent/route",pathname:"/api/create-payment-intent",filename:"route",bundlePath:"app/api/create-payment-intent/route"},resolvedPagePath:"/Users/rickschlimback/Desktop/WL1sep - nieuww/warmeleads-chat/src/app/api/create-payment-intent/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:y}=m,h="/api/create-payment-intent/route";function g(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:l})}},6029:(e,t,a)=>{a.d(t,{Ag:()=>s,_g:()=>o});var r=a(1059);let n=process.env.STRIPE_SECRET_KEY||"sk_test_dummy_for_build";process.env.STRIPE_SECRET_KEY||console.warn("STRIPE_SECRET_KEY not found, using dummy key for build");let s=new r.Z(n,{apiVersion:"2025-08-27.basil",typescript:!0});async function o(e){try{let t=await s.paymentIntents.retrieve(e);if("succeeded"===t.status){let a={paymentIntentId:e,customerId:t.customer,packageId:t.metadata.packageId,quantity:parseInt(t.metadata.quantity),industry:t.metadata.industry,type:t.metadata.type,amount:t.amount,currency:t.currency,customerName:t.metadata.customerName,customerCompany:t.metadata.customerCompany,createdAt:new Date(1e3*t.created)};return console.log("Order processed:",a),a}return null}catch(e){throw console.error("Error handling successful payment:",e),e}}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,843],()=>a(5474));module.exports=r})();