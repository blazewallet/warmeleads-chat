"use strict";(()=>{var e={};e.id=798,e.ids=[798],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},1764:e=>{e.exports=require("util")},507:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>v,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>k,staticGenerationAsyncStorage:()=>w});var r={};a.r(r),a.d(r,{GET:()=>h,POST:()=>u});var o=a(9303),n=a(8716),s=a(670),i=a(7070),c=a(6029);let d=process.env.STRIPE_WEBHOOK_SECRET;async function u(e){try{let t;let a=await e.text(),r=e.headers.get("stripe-signature");try{t=c.Ag.webhooks.constructEvent(a,r,d)}catch(e){return console.error("Webhook signature verification failed:",e),i.NextResponse.json({error:"Webhook signature verification failed"},{status:400})}switch(t.type){case"payment_intent.succeeded":{let e=t.data.object;console.log("Payment succeeded:",e.id),await (0,c._g)(e.id),await l(e);break}case"payment_intent.payment_failed":{let e=t.data.object;console.log("Payment failed:",e.id),await p(e);break}case"customer.created":{let e=t.data.object;console.log("Customer created:",e.id),await m(e);break}default:console.log(`Unhandled event type: ${t.type}`)}return i.NextResponse.json({received:!0})}catch(e){return console.error("Webhook handler error:",e),i.NextResponse.json({error:"Webhook handler failed"},{status:500})}}async function l(e){try{let t=await c.Ag.customers.retrieve(e.customer);"email"in t&&t.email&&console.log("Sending lead delivery notification to:",t.email),await y({customerId:e.customer,packageId:e.metadata.packageId,quantity:parseInt(e.metadata.quantity),industry:e.metadata.industry,type:e.metadata.type})}catch(e){console.error("Failed to send lead delivery notification:",e)}}async function p(e){try{let t=await c.Ag.customers.retrieve(e.customer);"email"in t&&t.email&&console.log("Sending payment failure notification to:",t.email)}catch(e){console.error("Failed to handle payment failure:",e)}}async function m(e){try{let t={email:e.email,name:e.name,phone:e.phone,company:e.metadata.company,source:"WarmeLeads Chat",createdAt:new Date(1e3*e.created)};console.log("Syncing customer to CRM:",t)}catch(e){console.error("Failed to sync customer to CRM:",e)}}async function y(e){try{console.log("Triggering lead delivery:",e)}catch(e){console.error("Failed to trigger lead delivery:",e)}}async function h(){return i.NextResponse.json({message:"Stripe webhook endpoint"})}let g=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/webhooks/stripe/route",pathname:"/api/webhooks/stripe",filename:"route",bundlePath:"app/api/webhooks/stripe/route"},resolvedPagePath:"/Users/rickschlimback/Desktop/WL1sep - nieuww/warmeleads-chat/src/app/api/webhooks/stripe/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:k}=g,v="/api/webhooks/stripe/route";function b(){return(0,s.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:w})}},6029:(e,t,a)=>{a.d(t,{Ag:()=>n,_g:()=>s});var r=a(1059);let o=process.env.STRIPE_SECRET_KEY||"sk_test_dummy_for_build";process.env.STRIPE_SECRET_KEY||console.warn("STRIPE_SECRET_KEY not found, using dummy key for build");let n=new r.Z(o,{apiVersion:"2025-08-27.basil",typescript:!0});async function s(e){try{let t=await n.paymentIntents.retrieve(e);if("succeeded"===t.status){let a={paymentIntentId:e,customerId:t.customer,packageId:t.metadata.packageId,quantity:parseInt(t.metadata.quantity),industry:t.metadata.industry,type:t.metadata.type,amount:t.amount,currency:t.currency,customerName:t.metadata.customerName,customerCompany:t.metadata.customerCompany,createdAt:new Date(1e3*t.created)};return console.log("Order processed:",a),a}return null}catch(e){throw console.error("Error handling successful payment:",e),e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,843],()=>a(507));module.exports=r})();